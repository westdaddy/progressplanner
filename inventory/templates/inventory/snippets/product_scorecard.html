{% load inventory_extras %}

<!-- Product Scorecard List -->
<ul class="collection">
  {% for product in products %}
  <li class="collection-item avatar lighten-4 {% if product.total_sales|default:0 == 0 and product.total_inventory|default:0 == 0 %}new{% endif %}">
      <div class="row item">
        <div class="col s2 photo">
          {% if product.product_photo %}
            <img src="{{ product.product_photo.url }}" alt="{{ product.product_name }}" class="circle product-photo-large">
          {% else %}
            <img src="{{ MEDIA_URL }}product_photos/product-placeholder.jpg" alt="{{ product.product_name }}" class="circle product-photo-large">
          {% endif %}
        </div>
        <div class="col s10 content">
          <div class="row title">
            <div class="col s12">
              <span class="title">
                <a href="{% url 'product_detail' product.id %}">
                  <strong>{{ product.product_name }}</strong>
                </a>
              </span>
              ({{ product.product_id }})
            </div>
          </div>
          <div class="row scorecard-boxes">
            <div class="col s12 m6 l3">
              <div class="card-panel scorecard-box">
                <span class="grey-text text-darken-1">Pricing Snapshot</span>
                <div class="metric">
                  <small class="grey-text">Retail Price</small>
                  <p class="metric-value">¥{{ product.retail_price|floatformat:2|default_if_none:"-" }}</p>
                </div>
                <div class="metric">
                  <small class="grey-text">Avg Actual Sold Price</small>
                  <p class="metric-value">¥{{ product.average_sale_price|floatformat:2|default_if_none:"-" }}</p>
                </div>
                <div class="metric">
                  <small class="grey-text">Avg % Discount</small>
                  <p class="metric-value">
                    {% if product.average_discount_percentage is not None %}
                      {{ product.average_discount_percentage|floatformat:1 }}%
                    {% else %}
                      -
                    {% endif %}
                  </p>
                </div>
              </div>
            </div>
            <div class="col s12 m6 l3">
              <div class="card-panel scorecard-box">
                <span class="grey-text text-darken-1">Profitability</span>
                <div class="metric">
                  <small class="grey-text">Actual Sold Price</small>
                  <p class="metric-value">¥{{ product.average_sale_price|floatformat:2|default_if_none:"-" }}</p>
                </div>
                <div class="metric">
                  <small class="grey-text">Avg Cost / Item</small>
                  <p class="metric-value">¥{{ product.average_cost_price|floatformat:2|default_if_none:"-" }}</p>
                </div>
                <div class="metric">
                  <small class="grey-text">Profit per Sale</small>
                  <p class="metric-value">
                    {% if product.profit_amount is not None %}
                      ¥{{ product.profit_amount|floatformat:2 }}
                      {% if product.profit_percentage is not None %}
                        <span class="grey-text">({{ product.profit_percentage|floatformat:1 }}%)</span>
                      {% endif %}
                    {% else %}
                      -
                    {% endif %}
                  </p>
                </div>
              </div>
            </div>
            <div class="col s12 m6 l3">
              <div class="card-panel scorecard-box">
                <span class="grey-text text-darken-1">Inventory Health</span>
                <p class="grey-text">Add inventory metrics here.</p>
              </div>
            </div>
            <div class="col s12 m6 l3">
              <div class="card-panel scorecard-box">
                <span class="grey-text text-darken-1">Engagement</span>
                <p class="grey-text">Add engagement metrics here.</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </li>
  {% endfor %}
</ul>
