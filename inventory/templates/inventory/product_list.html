{% extends 'inventory/base.html' %}
{% load inventory_extras %}

{% block title %}Product List{% endblock %}

{% block content %}
<div class="section">


  <div id="controls" class="row grey lighten-3">
    <div class="col s1">
      <div class="view-toggle">
        <a href="?{{ list_query }}"
           class="view-icon {% if view_mode == 'list' %}active{% endif %}">
          <i class="material-icons">view_list</i>
        </a>
        <a href="?{{ card_query }}"
           class="view-icon {% if view_mode == 'card' %}active{% endif %}">
          <i class="material-icons">view_module</i>
        </a>
      </div>
    </div>

    <div class="filters col s11">
      <form id="productFilterForm" method="get">

        <label class="checkbox-field">
          <input
            type="checkbox"
            name="show_retired"
            value="true"
            class="filled-in"
            {% if show_retired %}checked{% endif %}
            onchange="this.form.submit()"
          />
          <span>Show old products</span>
        </label>

        <label class="checkbox-field">
          <input
            type="checkbox"
            name="zero_inventory"
            value="true"
            class="filled-in"
            {% if zero_inventory %}checked{% endif %}
            onchange="this.form.submit()"
          />
          <span>Out of stock only</span>
        </label>

        <div class="input-field">
          <select name="type_filter" onchange="this.form.submit()">
            <option value="" {% if not type_filter %}selected{% endif %}>All types</option>
            {% for value, label in type_choices %}
              <option value="{{ value }}" {% if type_filter == value %}selected{% endif %}>{{ label }}</option>
            {% endfor %}
          </select>
          <label>Type</label>
        </div>

        <div class="input-field">
          <select name="style_filter" onchange="this.form.submit()">
            <option value="" {% if not style_filter %}selected{% endif %}>All styles</option>
            {% for value, label in style_choices %}
              <option value="{{ value }}" {% if style_filter == value %}selected{% endif %}>{{ label }}</option>
            {% endfor %}
          </select>
          <label>Style</label>
        </div>

        <div class="input-field">
          <select name="age_filter" onchange="this.form.submit()">
            <option value="" {% if not age_filter %}selected{% endif %}>All ages</option>
            {% for value, label in age_choices %}
              <option value="{{ value }}" {% if age_filter == value %}selected{% endif %}>{{ label }}</option>
            {% endfor %}
          </select>
          <label>Age</label>
        </div>

        <div class="checkbox-set">
          <span>Group:</span>
          {% for group in group_choices %}
            <label class="checkbox-field">
              <input
                type="checkbox"
                name="group_filter"
                value="{{ group.id }}"
                class="filled-in"
                {% if group.id|stringformat:'s' in group_filters %}checked{% endif %}
                onchange="this.form.submit()"
              />
              <span>{{ group.name }}</span>
            </label>
          {% endfor %}
        </div>

        <div class="checkbox-set">
          <span>Series:</span>
          {% for ser in series_choices %}
            <label class="checkbox-field">
              <input
                type="checkbox"
                name="series_filter"
                value="{{ ser.id }}"
                class="filled-in"
                {% if ser.id|stringformat:'s' in series_filters %}checked{% endif %}
                onchange="this.form.submit()"
              />
              <span>{{ ser.name }}</span>
            </label>
          {% endfor %}
        </div>

        <input type="hidden" name="view_mode" value="{{ view_mode }}" />
      </form>
    </div>

  </div>

  <!-- Conditional Product List Rendering -->
  {% if view_mode == 'card' %}
      {% include 'inventory/snippets/product_card_list.html' %}
  {% else %}
      {% include 'inventory/snippets/product_card_default.html' %}
  {% endif %}
</div>
{% endblock %}

{% block extrajs %}
<script>
  document.addEventListener('DOMContentLoaded', function() {
    var elems = document.querySelectorAll('select');
    var instances = M.FormSelect.init(elems);
  });
</script>
{% endblock %}
