{% extends 'inventory/base.html' %}
{% load inventory_extras %}

{% block title %}Product List{% endblock %}

{% block content %}
<div class="section">


  <div id="controls" class="row grey lighten-3">
    <div class="col s1">
      <div class="view-toggle">
        <a href="?view_mode=list
                 {% if show_retired %}&show_retired=true{% endif %}
                 {% if type_filter  %}&type_filter={{ type_filter }}{% endif %}
                 {% if zero_inventory %}&zero_inventory=true{% endif %}"
           class="view-icon {% if view_mode == 'list' %}active{% endif %}">
          <i class="material-icons">view_list</i>
        </a>
        <a href="?view_mode=card
                 {% if show_retired %}&show_retired=true{% endif %}
                 {% if type_filter  %}&type_filter={{ type_filter }}{% endif %}
                 {% if zero_inventory %}&zero_inventory=true{% endif %}"
           class="view-icon {% if view_mode == 'card' %}active{% endif %}">
          <i class="material-icons">view_module</i>
        </a>
      </div>
    </div>

    <div class="filters">
  <form method="get">

    <div class="col s3" style="margin-top: 1rem;">
      <!-- Show retired products checkbox -->
      <label>
        <input
          type="checkbox"
          name="show_retired"
          value="true"
          class="filled-in"
          {% if show_retired %}checked{% endif %}
          onchange="this.form.submit()"
        />
        <span>Show old products</span>
      </label>

      <!-- Out of stock only checkbox -->
      <label>
        <input
          type="checkbox"
          name="zero_inventory"
          value="true"
          class="filled-in"
          {% if zero_inventory %}checked{% endif %}
          onchange="this.form.submit()"
        />
        <span>Out of stock only</span>
      </label>
    </div>

    <!-- Type filter select -->
    <div class="input-field inline col s4">
      <select
        name="type_filter"
        id="type_filter"
        onchange="this.form.submit()"
      >
        <option value="" {% if not type_filter %}selected{% endif %}>All types</option>
        {% for value, label in type_choices %}
          <option
            value="{{ value }}"
            {% if type_filter == value %}selected{% endif %}
          >
            {{ label }}
          </option>
        {% endfor %}
      </select>
    </div>

    <!-- Preserve view mode when submitting -->
    <input
      type="hidden"
      name="view_mode"
      value="{{ view_mode }}"
    />
  </form>
</div>
  </div>

  <!-- Conditional Product List Rendering -->
  {% if view_mode == 'card' %}
      {% include 'inventory/snippets/product_card_list.html' %}
  {% else %}
      {% include 'inventory/snippets/product_card_default.html' %}
  {% endif %}
</div>
{% endblock %}

{% block extrajs %}
<script>
  document.addEventListener('DOMContentLoaded', function() {
    var elems = document.querySelectorAll('select');
    var instances = M.FormSelect.init(elems);
  });
</script>
{% endblock %}
