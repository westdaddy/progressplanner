{% extends 'inventory/base.html' %}

{% block title %}Orders{% endblock %}

{% block content %}



<div class="section">
  <h3>Suggested Order Planner</h3>

  <div class="row">
    <form class="col s12" method="get">
      <div class="input-field col s12 m8">
        <input id="product-search" name="product_search" type="text" value="{{ search_query }}">
        <label for="product-search">Search by product code or name</label>
      </div>
      <div class="input-field col s12 m4">
        <button class="btn waves-effect waves-light" type="submit">Search</button>
      </div>
    </form>
  </div>

  {% if search_query %}
    <div class="row">
      <div class="col s12">
        <ul class="collection">
          {% for product in matching_products %}
            <li class="collection-item">
              <a href="{% url 'order_list' %}?product={{ product.id }}&product_search={{ search_query|urlencode }}">
                {{ product.product_name }} ({{ product.product_id }})
              </a>
            </li>
          {% empty %}
            <li class="collection-item grey-text">No matching products found.</li>
          {% endfor %}
        </ul>
      </div>
    </div>
  {% endif %}

  {% if selected_product %}
    {% include 'inventory/snippets/product_card.html' with product=selected_product %}
    <div class="row">
      <div class="col s12">
        <div class="card-panel">
          <h5>Suggested Order Analysis</h5>
          <p class="grey-text">Suggested order sizes, confidence, and reorder timing will appear here.</p>
          <ul class="collection">
            <li class="collection-item">Recommended order quantity: —</li>
            <li class="collection-item">Confidence score: —</li>
            <li class="collection-item">Notes: —</li>
          </ul>
        </div>
      </div>
    </div>
  {% endif %}

  <h3>Stock Orders</h3>

  <div class="row">
{% for block in calendar_data %}
  <div class="col s3">
    <div class="card red lighten-4 z-depth-2" style="height:500px;">
      <div class="card-content center-align">
        <span class="grey-text">{{ block.month_label }}</span>
        {% if block.events %}
          <ul>
            {% for ev in block.events %}
              <li>
                <img src="{% if ev.product.product_photo %}{{ ev.product.product_photo.url }}{% endif %}"
                     alt="{{ ev.product.product_name }}"
                     style="width:24px; height:24px; object-fit:cover; border-radius:2px; margin-right:4px;">
                {{ ev.product.product_name }} × {{ ev.quantity }}
              </li>
            {% endfor %}
          </ul>
        {% else %}
          <p><em>No arrivals</em></p>
        {% endif %}
      </div>

    </div>
  </div>
{% endfor %}
</div>
</div> <!-- END OF SECTION -->


<div class="section">
    <h1 class="center-align">Stock Orders</h1>

    <ul class="collection">
        {% for order in orders %}
            <li class="collection-item">
                <a href="{% url 'order_detail' order.id %}">
                    <strong>#{{ order.invoice_id }}</strong> - {{ order.order_date }}
                </a>
                <p>Total Value: {{ order.total_value }}</p>
            </li>
        {% endfor %}
    </ul>
</div>
{% endblock %}
